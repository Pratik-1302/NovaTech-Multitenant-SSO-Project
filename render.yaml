# =============================================================================
# Render Blueprint for NovaTech SSO Management System
# =============================================================================
# This file defines the infrastructure for deploying to Render
# Custom Domain: pratiktech.cloud
# =============================================================================

services:
  # =============================================================================
  # Web Service - NovaTech Application
  # =============================================================================
  - type: web
    name: novatech-sso
    env: docker  # Render requires 'docker' for Java applications in Blueprints
    plan: free  # Free tier - app spins down after 15 min inactivity
    region: oregon  # Change to your preferred region (oregon, frankfurt, singapore, ohio)
    
    # Build and start are handled by Dockerfile
    
    # Environment Variables
    envVars:
      # Application Profile
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      
      # Database Connection (auto-populated by Render)
      - key: DATABASE_URL
        fromDatabase:
          name: novatech-db
          property: connectionString
      
      # Custom Domain Configuration
      - key: CUSTOM_DOMAIN
        value: pratiktech.cloud
      
      - key: ALLOWED_ORIGINS
        value: https://pratiktech.cloud,https://www.pratiktech.cloud
      
      # Security Settings
      - key: COOKIE_SECURE
        value: true
      
      # Performance Settings
      # Reduced for free tier database connection limits
      - key: DB_POOL_SIZE
        value: 5
      
      # Java Options for Production
      # Free tier has 512MB RAM - Xmx set to 300m to prevent OOM crashes
      - key: JAVA_OPTS
        value: -Xmx300m -Xms128m -XX:+UseG1GC
    
    # Health Check Configuration
    healthCheckPath: /login
    
    # Auto-Deploy Configuration
    autoDeploy: true
    branch: main  # Change to your default branch if different

# =============================================================================
# PostgreSQL Database
# =============================================================================
databases:
  - name: novatech-db
    databaseName: novatech_db
    user: novatech_user
    plan: free  # Free tier - valid for 90 days, then expires
    region: oregon  # Must match web service region for best performance
    
    # PostgreSQL Version
    ipAllowList: []  # Empty = allow connections from Render services only
