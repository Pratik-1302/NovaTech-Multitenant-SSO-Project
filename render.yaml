# =============================================================================
# Render Blueprint for NovaTech SSO Management System
# =============================================================================
# This file defines the infrastructure for deploying to Render
# Custom Domain: pratiktech.cloud
# =============================================================================

services:
  # =============================================================================
  # Web Service - NovaTech Application
  # =============================================================================
  - type: web
    name: novatech-sso
    env: docker  # Render requires 'docker' for Java applications in Blueprints
    plan: starter  # Change to 'standard' or higher for production workloads
    region: oregon  # Change to your preferred region (oregon, frankfurt, singapore, ohio)
    
    # Build and start are handled by Dockerfile
    
    # Environment Variables
    envVars:
      # Application Profile
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      
      # Database Connection (auto-populated by Render)
      - key: DATABASE_URL
        fromDatabase:
          name: novatech-db
          property: connectionString
      
      # Custom Domain Configuration
      - key: CUSTOM_DOMAIN
        value: pratiktech.cloud
      
      - key: ALLOWED_ORIGINS
        value: https://pratiktech.cloud,https://www.pratiktech.cloud
      
      # Security Settings
      - key: COOKIE_SECURE
        value: true
      
      # Performance Settings
      - key: DB_POOL_SIZE
        value: 20
      
      # Java Options for Production
      # CRITICAL: On Starter plan (512MB RAM), Xmx must be <512MB to leave room for OS & Metaspace
      - key: JAVA_OPTS
        value: -Xmx384m -Xms256m -XX:+UseG1GC -XX:MaxGCPauseMillis=200
    
    # Health Check Configuration
    healthCheckPath: /login
    
    # Auto-Deploy Configuration
    autoDeploy: true
    branch: main  # Change to your default branch if different

# =============================================================================
# PostgreSQL Database
# =============================================================================
databases:
  - name: novatech-db
    databaseName: novatech_db
    user: novatech_user
    plan: starter  # Change to 'standard' for production (includes daily backups)
    region: oregon  # Must match web service region for best performance
    
    # PostgreSQL Version
    ipAllowList: []  # Empty = allow connections from Render services only
